"use strict";(self.webpackChunkcodeeatcode_github_io=self.webpackChunkcodeeatcode_github_io||[]).push([[545],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return m}});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),h=c(n),m=o,d=h["".concat(l,".").concat(m)]||h[m]||u[m]||i;return n?a.createElement(d,r(r({ref:t},p),{},{components:n})):a.createElement(d,r({ref:t},p))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,r[1]=s;for(var c=2;c<i;c++)r[c]=n[c];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},7267:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return l},default:function(){return m},frontMatter:function(){return s},metadata:function(){return c},toc:function(){return u}});var a=n(7462),o=n(3366),i=(n(7294),n(3905)),r=["components"],s={title:"JSON Web Tokens",slug:"JSON-WEB-TOKEN",description:"Repost from https://medium.com/@ambersariya/jwt-json-web-token-cd90ef7a7a66",modified:new Date("2022-05-18T13:04:02.637Z"),date:new Date("2017-02-28T11:45:44.128Z")},l=void 0,c={permalink:"/blog/JSON-WEB-TOKEN",source:"@site/blog/JSON Web Tokens/JSON Web Tokens.md",title:"JSON Web Tokens",description:"Repost from https://medium.com/@ambersariya/jwt-json-web-token-cd90ef7a7a66",date:"2017-02-28T11:45:44.128Z",formattedDate:"February 28, 2017",tags:[],readingTime:5.02,truncated:!1,authors:[],frontMatter:{title:"JSON Web Tokens",slug:"JSON-WEB-TOKEN",description:"Repost from https://medium.com/@ambersariya/jwt-json-web-token-cd90ef7a7a66",modified:"2022-05-18T13:04:02.637Z",date:"2017-02-28T11:45:44.128Z"},prevItem:{title:"Journey To The Centre Of The Stack",permalink:"/blog/journey-to-the-centre-of-the-stack"},nextItem:{title:"Blogging Like a Hacker",permalink:"/blog/blogging-like-a-hacker"}},p={authorsImageUrls:[]},u=[{value:"What is it?",id:"what-is-it",level:2},{value:"So, what does It Look Like?",id:"so-what-does-it-look-like",level:2},{value:"How does the Authentication Flow work?",id:"how-does-the-authentication-flow-work",level:2},{value:"Making a case for JWT",id:"making-a-case-for-jwt",level:2},{value:"Problems with JWT",id:"problems-with-jwt",level:2},{value:"Conclusion",id:"conclusion",level:2},{value:"Further Reading",id:"further-reading",level:2}],h={toc:u};function m(e){var t=e.components,n=(0,o.Z)(e,r);return(0,i.kt)("wrapper",(0,a.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"what-is-it"},"What is it?"),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},(0,i.kt)("em",{parentName:"p"},"JSON Web Token (JWT) is a compact, URL-safe means of representing claims to be transferred between two parties. The claims in a JWT are encoded as a JSON object that is used as the payload of a JSON Web Signature (JWS) structure or as the plaintext of a JSON Web Encryption (JWE) structure, enabling the claims to be digitally signed or integrity protected with a Message Authentication Code (MAC) and/or encrypted."))),(0,i.kt)("p",null,"JSON Web Tokens are an open, industry-standard ",(0,i.kt)("a",{parentName:"p",href:"https://tools.ietf.org/html/rfc7519"},(0,i.kt)("strong",{parentName:"a"},"RFC 7519"))," method for representing claims securely between two parties. See here: ",(0,i.kt)("a",{parentName:"p",href:"https://jwt.io",title:"https://jwt.io"},"https://jwt.io")),(0,i.kt)("p",null,'In this context, "claim" can be something like a "command", a one-time authorization, or basically any other scenario that you can word as:'),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},(0,i.kt)("em",{parentName:"p"},'Hello Server B, Server A told me that I could "',(0,i.kt)("strong",{parentName:"em"},"claim goes here"),'", and here\u2019s the (cryptographic) proof.'))),(0,i.kt)("p",null,"Before we dive into this further, I\u2019d like to define some terms we use in the realm of authentication."),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("em",{parentName:"strong"},"Authentication"))," ",(0,i.kt)("em",{parentName:"p"},"\u2014 Proving who you are")),(0,i.kt)("p",{parentName:"blockquote"},(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("em",{parentName:"strong"},"Authorization"))," ",(0,i.kt)("em",{parentName:"p"},"\u2014 Being granted access to resources")),(0,i.kt)("p",{parentName:"blockquote"},(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("em",{parentName:"strong"},"Token"))," ",(0,i.kt)("em",{parentName:"p"},"\u2014 medium used to persist authentication and get authorization"))),(0,i.kt)("h2",{id:"so-what-does-it-look-like"},"So, what does It Look Like?"),(0,i.kt)("p",null,"Well, it looks like another confusing looking string"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ\n")),(0,i.kt)("p",null,"Upon closer inspections, you\u2019ll see that this JWT consist of three parts separated by dots (",(0,i.kt)("inlineCode",{parentName:"p"},"."),"), which are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Header")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Payload")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Signature"),(0,i.kt)("p",{parentName:"li"},"  Header.Payload.Signature"))),(0,i.kt)("p",null,"So, let\u2019s break it down a little:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"// header\n    eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9\n// payload\n    .eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9\n// signature\n    .TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"# Header")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"// HS256 indicates that this token is signed using HMAC-SHA256.\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'{\n    "alg": "HS256",\n    "typ": "JWT"\n}\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"# Claims/Payload")),(0,i.kt)("p",null,"// The payload contains the claims that we wish to make:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'{ "sub": "1234567890", "name": "John Doe", "admin": true}\n')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"# Signature")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'HMACSHA256(encodeBase64(header) + "." + encodeBase64(payload), secret)\n\n// e.g.Using the formula above we get thiseyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJsb2dnZWRJbkFzIjoiYWRtaW4iLCJpYXQiOjE0MjI3Nzk2Mzh9.gzSraSYS8EXBxLN_oWnFSRgCzcmJmMjLiuyu5CSpyHI\n')),(0,i.kt)("p",null,"Let\u2019s expand on the claims section of JWT. The following claims are part of the RFC document:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"**iss**: who is the issuer of this token auth.example.com\n**sub**: what is the subject of this token e.g. auth\n**aud**: who can use this token e.g ['client1.example.com','client2.example.com']\n**exp**: Defines the expiration time as unix timestamp e.g. 1488192525\n**nbf**: define how long after the issued token was generated we can use it e.g. 300 seconds (5 minutes)\n**iat**: issued at is a unix timestamp e.g. 1488192525\n**jti**: JWT ID unique id. This can be used to prevent a token from being replayed e.g. \"xa443D\"\n")),(0,i.kt)("p",null,"The key names are case sensitive and have been kept small to keep the JSON payload compact."),(0,i.kt)("h2",{id:"how-does-the-authentication-flow-work"},"How does the Authentication Flow work?"),(0,i.kt)("p",null,"In authentication, when the user successfully logs in using their credentials, a JSON Web Token will be returned and must be saved locally (typically in local storage, but cookies can be also used), instead of the traditional approach of creating a session in the server and returning a cookie."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'POST /login\n\n{\n    email: "username@example-domain.com"\n    password: "5\xa3cUr3PA$$W0rd!"\n}\n\nResponse 201 Created\n{\n    token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ"\n}\n')),(0,i.kt)("p",null,"Any subsequent calls to the API would typically send the Authorization header using the Bearer schema."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"Authorization: Bearer myToken\n")),(0,i.kt)("p",null,"Therefore the content of the header should look like the following."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"GET /\nHeaders: Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ\n")),(0,i.kt)("p",null,"This is a stateless authentication mechanism as the user state is never saved in the server memory. The server\u2019s protected routes will check for a valid JWT in the Authorization header, and if there is, the user will be allowed."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"signature valid?"),(0,i.kt)("li",{parentName:"ul"},"client allowed? aud- expected issuer? iss- can this token be used? nbf")),(0,i.kt)("p",null,"As JWTs are self-contained, all the necessary information is there, reducing the need of going back and forward to the database. This allows us to fully rely on data APIs that are stateless and even make requests to downstream services. It doesn\u2019t matter which domains are serving the APIs, as Cross-Origin Resource Sharing (CORS) won\u2019t be an issue as it doesn\u2019t use cookies."),(0,i.kt)("h2",{id:"making-a-case-for-jwt"},"Making a case for JWT"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Portability"),": they work across many different platforms, having implementations in various programming languages."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Compact"),": Because of its size, it can be sent through an URL, POST parameter, or inside an HTTP header. Additionally, due to its size its transmission is fast."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Self-contained:")," The payload contains all the required information about the user, to avoid querying the database more than once."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Control:")," Allows fine grained control over types of permissions. You can specify detailed access control information within ",(0,i.kt)("em",{parentName:"li"},"the token itself")," as part of its payload. For instance, in the same way that you can create AWS security policies with very specific permissions, you can limit the token to only give read/write access to a single resource. In contrast, API Keys tend to have a coarse all-or-nothing access.")),(0,i.kt)("h2",{id:"problems-with-jwt"},"Problems with JWT"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Cannot be used in place of Sessions & Cookies. If we want to use them in such a manner, then stick with Sessions and Cookies."),(0,i.kt)("li",{parentName:"ul"},"Data goes stale. For instance, an admin with a JWT token has had their access revoked but the token will keep on working because it was generated and verified correctly with the secret key."),(0,i.kt)("li",{parentName:"ul"},"There\u2019s a critical vulnerability when using Asymmetric keys. The attackers know which algorithm was used to generate the token. This is open to abuse from the attackers. The server should already know which algorithm was used to generate/verify the integrity of this token.")),(0,i.kt)("h2",{id:"conclusion"},"Conclusion"),(0,i.kt)("p",null,"JSON Web Tokens offer many advantages but not without having some drawbacks. If you work on an extremely large-scale application, sessions could be the appropriate choice. It is completely reasonable to combine sessions and JWT \u2014 they each have their own purpose, and sometimes you need both. Just don\u2019t use JWT for ",(0,i.kt)("em",{parentName:"p"},"persistent")," data."),(0,i.kt)("hr",null),(0,i.kt)("h2",{id:"further-reading"},"Further Reading"),(0,i.kt)("p",null,"Thanks to the following:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://tools.ietf.org/html/rfc7519",title:"https://tools.ietf.org/html/rfc7519"},"https://tools.ietf.org/html/rfc7519")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html#RegisteredClaimName",title:"http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html#RegisteredClaimName"},"http://self-issued.info/docs/draft-ietf-oauth-json-web-token.html#RegisteredClaimName")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://auth0.com/blog/critical-vulnerabilities-in-json-web-token-libraries/",title:"https://auth0.com/blog/critical-vulnerabilities-in-json-web-token-libraries/"},"https://auth0.com/blog/critical-vulnerabilities-in-json-web-token-libraries/")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://auth0.com/learn/json-web-tokens/",title:"https://auth0.com/learn/json-web-tokens/"},"https://auth0.com/learn/json-web-tokens/")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.slideshare.net/lcobucci/jwt-to-authentication-and-beyond",title:"https://www.slideshare.net/lcobucci/jwt-to-authentication-and-beyond"},"https://www.slideshare.net/lcobucci/jwt-to-authentication-and-beyond")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.slideshare.net/a_z_e_t/javascript-object-signing-encryption",title:"https://www.slideshare.net/a_z_e_t/javascript-object-signing-encryption"},"https://www.slideshare.net/a_z_e_t/javascript-object-signing-encryption")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"http://christhorntonsf.com/secure-your-apis-with-jwt/",title:"http://christhorntonsf.com/secure-your-apis-with-jwt/"},"http://christhorntonsf.com/secure-your-apis-with-jwt/")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"http://cryto.net/~joepie91/blog/2016/06/13/stop-using-jwt-for-sessions/",title:"http://cryto.net/~joepie91/blog/2016/06/13/stop-using-jwt-for-sessions/"},"http://cryto.net/","~","joepie91/blog/2016/06/13/stop-using-jwt-for-sessions/"))))}m.isMDXComponent=!0}}]);